<!DOCTYPE html>
<html lang="en">
<head>
    <title>Authentication</title>
    <!-- Copyright Embedthis Software, LLC, 2003-2014. All Rights Reserved. -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="appweb, embedded web server, embedded, devices, http server, internet of things, esp, goahead" />
    <meta name="description" content="The fastest little web server" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700'
        rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Julius+Sans+One' rel='stylesheet' type='text/css'>
    <link href="../lib/semantic/themes/packages/beach.css" rel="stylesheet" type="text/css" />
    <link href="../css/all.css" rel="stylesheet" type="text/css" />
    <link href="../images/favicon.ico" rel="shortcut icon" />

</head>
<body>
        <div class="sidebar">
        <div class="ui large left vertical inverted labeled menu">
            <div class="item">
                <a href="../index.html" class="logo">Appweb Docs</a>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../index.html">Home</a>
                    <a class="item" href="../users/features.html">Appweb Features</a>
                    <a class="item" href="https://embedthis.com/appweb/download.html">Download</a> 
                    <a class="item" href="../licensing/index.html">Licensing</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../start/index.html">Getting Started</a>
                    <a class="item" href="../start/quick.html">Quick Start</a>
                    <a class="item" href="../start/installing.html">Installing Appweb</a>
                    <a class="item" href="../start/starting.html">Starting and Stopping</a>
                    <a class="item" href="../start/service.html">Running as a Service</a>
                    <a class="item" href="../start/releaseNotes.html">Release Notes</a>
                    <a class="item" href="../start/source.html">Building from Source</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../users/index.html">User's Guide</a>
                    <a class="item" href="../users/configuration.html">Configuring Appweb</a>
                    <a class="item" href="../users/directives.html">Configuration Directives</a>
                    <a class="item" href="../users/frameworks.html">Web Frameworks</a>
                    <a class="item" href="../users/modules.html">Using Loadable Modules</a>
                    <a class="item" href="../users/ports.html">Ports and Binding</a>
                    <a class="item" href="../users/routing.html">Routing Requests</a>
                    <a class="item" href="../users/stages.html">Request Pipeline</a>
                    <a class="item" href="../users/lang.html">Multi-Language Content</a>
                    <a class="item" href="../users/authentication.html">User Authorization</a>
                    <a class="item" href="../users/logFiles.html">Logging</a>
                    <a class="item" href="../users/caching.html">Caching</a>
                    <a class="item" href="../users/vhosts.html">Virtual Hosts</a>
                    <a class="item" href="../users/ssl.html">Secure Sockets (SSL)</a>
                    <a class="item" href="../users/client.html">Http Client</a>
                    <a class="item" href="../users/security.html">Security Considerations</a>
                    <a class="item" href="../users/monitor.html">Monitoring and Defending</a>
                    <a class="item" href="../users/uploading.html">File Upload</a>
                    <a class="item" href="../users/webSockets.html">WebSockets</a>
                    <a class="item" href="../users/man.html">Man Pages</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../developers/index.html">Developer's Guide</a>
                    <a class="item" href="../developers/embedding.html">Embedding Appweb</a>
                    <a class="item" href="../developers/modules.html">Creating Appweb Modules</a>
                    <a class="item" href="../developers/handlers.html">Creating Appweb Handlers</a>
                    <a class="item" href="../developers/stages.html">Creating Pipeline Stages</a>
                    <a class="item" href="../developers/migrating.html">Migrating to Appweb 5</a>
                    <a class="item" href="../developers/rom.html">Serving Pages from ROM</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../ref/index.html">Reference Guide</a>
                    <a class="item" href="../ref/compatibility.html">Compatibility</a>
                    <a class="item" href="../ref/native.html">Native APIs</a>
                    <a class="item" href="../ref/architecture.html">Appweb Architecture</a>
                    <a class="item" href="../ref/memory.html">Appweb Memory Allocation</a>
                    <a class="item" href="../ref/multithread.html">Multithreaded Programming</a>
                    <a class="item" href="../standards/http.html">HTTP References</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../developers/project.html">Project Resources</a>
                    <a class="item" href="http://goo.gl/dGRDl4">Official Appweb News</a>
                    <a class="item" href="https://embedthis.com/appweb/">Appweb Web Site</a>
                    <a class="item" href="https://github.com/embedthis/appweb">Source Code Repository</a>
                    <a class="item" href="https://github.com/embedthis/appweb/issues">Project Issue Database</a>
                    <a class="item" href="https://github.com/embedthis/appweb/releases">Change Log</a>
                    <a class="item" href="https://github.com/embedthis/appweb/milestones">Roadmap</a>
                    <a class="item" href="https://embedthis.com/developers/contributors.html">Contributors Agreement</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <span class="header item">Links</span>
                    <a class="item" href="https://embedthis.com/">Embedthis Web Site</a>
                    <a class="item" href="https://embedthis.com/blog/">Embedthis Blog</a>
                    <a class="item" href="http://twitter.com/mobstream">Twitter</a>
                </div>
            </div>
        </div>
    </div>

    <div class="ui sidebar-launch button">
        <i class="icon list layout"></i>
    </div>





    <div class="masthead">
         
        <div class="ui inverted menu">
            <div class="right menu">
                  
                    <a class="item" href="https://embedthis.com/">Embedthis</a>
                    <a class="item" href="https://embedthis.com/appweb/">Appweb Site</a>
                    <a class="item" href="http://goo.gl/dGRDl4">Appweb News</a>
                    <a class="item" href="https://github.com/embedthis/appweb">Repository</a>
                    <a class="item" href="https://embedthis.com/blog/">Blog</a>
                    <a class="item" href="https://twitter.com/mobstream">Twitter</a>

            </div>
        </div>
        
        <div class="ui breadcrumb">
            <a class="section" href="../">Home</a>
            
            <div class="divider">/</div>
            <a class="section" href="index.html">
                User's Guide
            </a>
            
            
            <div class="divider">/</div>
            <a class="active section" href="authentication.html">Authentication</a>
            
        </div>
        
        <div class="ui right floated basic segment version">
            v5.2.0
        </div>

    </div>
    <div class="content">

            <h1>Authentication</h1>
            <p>Authentication is the process by which a client's identity and abilities are verified before granting
            access to server resources. Authentication is essential when you have content that you wish to protect and
            provide only to specific, approved clients.</p>
            <p>Appweb implements a powerful and flexible authentication mechanism that supports Basic, Digest and
            Form authentication schemes. Appweb employs unified and flexible authentication front and back ends
            that can be mixed and matched to meet most authentication needs.</p>
            
            <a id="basicAuthentication"></a>
            <h2>Authentication Schemes</h2>
            <p>Appweb provides several authentication schemes.
            <ul>
                <li>Basic Authentication</li>
                <li>Digest Authentication</li>
                <li>Form Authentication</li>
                <li>Custom via API</li>
            </ul>
            <p>Basic and Digest authentication are HTTP protocol mechanisms defined by the <a href=
            "http://www.w3.org/Protocols/rfc2616/rfc2616.html">HTTP/1.1 RFC2616</a> specification. Because they operate
            at the protocol level, they offer a low level of capability and flexibility. When a client attempts to access
            secured content, the client's browser displays a generic pop-up dialog box to prompt for the user's
            credentials. When submitted, the Appweb server consults the appropriate user password store to authenticate the
            user. While this scheme works, applications increasingly need to utilize an application-level user login
            mechanism that is more integrated into the overall look-and-feel of the application. Such login facilities
            are defined using web forms and HTTP POST requests from standard web page forms. Appweb calls this scheme the
            the Form-based authentication scheme.</p>
            <h2>Basic Authentication</h2>
            <p>Basic authentication was the original HTTP/1.0 authentication scheme. It transmits user names and
            passwords using a trivial encoding that is no better than using plain text.</p>
            <p><b>SECURITY WARNING</b>: You should not use Basic Authentication if at all possible. Use Digest
            Authentication instead if it is supported by your clients. If you must use Basic Authentication, use it over
            TLS/SSL which will encrypt the password over the wire.</p>
            <h2>Basic Authentication Directives</h2>
            <p>Appweb basic authentication is controlled by configuration file directives that may be used inside a
            Route or VirtualHost block, or within the Default server configuration.</p>
            <pre class="ui code segment">
&lt;Route /private/&gt;
    <b>AuthType basic</b>
    AuthRealm "example.com"
    User julie 9d8873a123eb506e7f8e84d1f2a26916 view
    Require user julie
&lt;/Route&gt;
</pre>
            <p>This example restricts access to URIs beginning with "/private". It permits access to the user
            "julie" once authenticated.</p>
            <p>The <a href="dir/auth.html#authType">AuthType</a> directive specifies that basic authentication is being
            used. The <a href="dir/auth.html#authName">AuthRealm</a> directive specifies the realm of access to Appweb.
            The realm is used in combination with the username and password to encrypt the password.
            The <a href="dir/auth.html#User">AuthUserFile</a> directive specifies the location of the user
            password file. You may use a single password file for all authentication, or you can use different files for
            each authentication section.</p>
            <p>The <a href="dir/auth.html#user">User</a> directive defines a user by name with an encrypted password and
            zero or more roles for the user. Typically, User and Role directives are placed in a separate configuration 
            file called <em>auth.conf</em> and are included via an <em>"include auth.conf"</em> directive.
            To create passwords, see the section
            below that describes the <a href="#authpass">authpass</a> utility.</p>
            <h3>Require Directive</h3>
            <p>The <a href="dir/auth.html#require">Require</a> directive controls access to the resources managed by
            the route. There are three possibilities to control access: require specific named users, 
            require a secure protocol such as TLS/SSL to be used, and require that the authenticated user possess 
            a set of specified abilities. </p>
            <ul>
                <li>Require user username ...</li>
                <li>Require ability name...</li>
                <li>Require secure</li>
            </ul>
            <p>When using <em>Require ability</em>, the abilities may be roles defined via the 
            <a href="dir/auth.html#role">Role</a> directive, or they may be simple words which represent a discrete
            ability that is explicitly specified in the <a href="dir/auth.html#user">User</a> directive.
            <p>The <em>require secure</em> directive specifies that the SSL/TLS protocol must be used for the
            request to permit access.</p>
            <p>Note: These three require directive alternatives may be used in combination. However, multiple
            <em>Require user</em> or multiple <em>Require ability</em> directives are not supported. The last 
            directive will take precedence.</p>
            <p><b>SECURITY WARNING</b>: it is essential that the authentication file be stored outside
            the Documents directory or any directory serving content.</p>
            
            <a id="digestAuthentication"></a>
            <h2>Digest Authentication</h2>
            <p>The Digest authentication scheme is a modern replacement for the Basic authentication scheme. It uses
            cryptographic techniques to encode passwords and does not transmit sensitive information in clear-text.</p>
            <h2>Digest Authentication Directives</h2>
            <p>Appweb digest authentication is controlled by configuration file directives that may be used within any
            Route, VirtualHost block or within the Default server configuration.</p>
            <pre class="ui code segment">
&lt;Route /private/&gt;
    <b>AuthType Digest</b>
    AuthRealm "example.com"
    include auth.conf
    Require user peter
&lt;/Route&gt;
</pre>
            <p>This example restricts access to the "/private" directory and all sub-directories to users whose username
            and password are validated against the designated user.db password file. The essential differences between
            this example and the Basic Authentication example is the AuthType directive.</p><a id="auth"></a>
            <a id="formAuthentication"></a>
            <h2>Form Authentication</h2>
            <p>The Form-based authentication scheme uses a standard web page form that prompts the user to enter their
            name and password. These values are then submitted to Appweb via a standard Http POST request. Appweb
            analyzes the user and password, and if authenticated, a login session is created and a cookie is returned 
            to the users's browser. Subsequent requests that include the cookie will be automatically authenticated and
            served.</p>
            <p>The <a href="dir/auth.html#authType">AuthType form</a> directive controls how Form authentication
            operates. The form variant of AuthType specifies the login web page, the login service URI, the logout 
            service URI and the destination web page once authenticated. The format is:
    <pre class="ui code segment">AuthType form Login-Page Login-Service Logout-Service Logged-In-Destination</pre>
            <p>For example:</p>
            <pre class="ui code segment">
&lt;Route ^/&gt;
    <b>AuthType form /auth/login.html /auth/login /auth/logout /</b>
&lt;/Route&gt; 
</pre>
            <p>This directive enables Form authentication for all requests and will redirect the client browser to
            <em>/auth/login.html</em> to prompt for the username and password. This example uses a plain HTML web page, but 
            the web page can be created in ESP, PHP, CGI or any other web framework. The web page should submit the username
            and password to the <em>/auth/login</em> login service. When logout is required, the client should submit
            a HTTP POST request to the logout service URI <em>/auth/logout</em>. The last field in the AuthType
            directive is the destination URI to which the client's browser will be redirected once logged in. </p>
            <h3>Login Service</h3>
            <p>The Login-Service is URI that is bound to an internal service to receive the <em>username</em> and 
            <em>password</em> and authenticate the user. This service expects the username/password to be submitted 
            via POST data using the form input fields "username" and "password". You can supply your own login and
            logout service by specifying the empty string <em>""</em> for the Login-Service in the AuthType directive.
            If using your own Login Service, you should call <em>httpLogin</em> to validate the user against the
            configured password store.</p> 
            
            <h3>Web Form</h3>
            <p>Here is a minimal example login form:</p>
            <pre class="ui code segment">
&lt;html&gt;&lt;head&gt;&lt;title&gt;login.html&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;Please log in&lt;/p&gt;
    &lt;form name="details" method="post" <b>action="/auth/login"</b>&gt;
        Username &lt;input type="text" <b>name="username"</b> value=''&gt;&lt;br/&gt;
        Password &lt;input type="password" <b>name="password"</b> value=''&gt;&lt;br/&gt;
        &lt;input type="submit" name="submit" value="OK"&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
            <p>The two submitted fields must be named <em>username</em> and <em>password</em>. 
            <p>If the login attempt succeeds, the client will receive a response including a session cookie and 
            will be redirected to the Destination URI. If the destination URI includes a <em>referrer:</em> prefix and
            the login form request contained a referrer URI in the HTTP header, then that referrer URI will be used
            as the destination instead of the hard-wired destination.</p>
            <h3>Securing the Password</h3>
            <p><b>SECURITY WARNING:</b> The Form authentication mechanism submits the user password as plain text. To secure
            communications, the Form authentication scheme should be used over a secure connection using TLS/SSL.
            To achieve this, you should create a route which redirects the client to the secure login form.  For
            example: </p>
            <pre class="ui code segment">
Listen 443
&lt;VirtualHost *:443&gt;
    SSLEngine on openssl
    # More SSL directives if required
    AuthType form /login.html /login /logout referrer:/index.html
&lt;/VirtualHost&gt;
&lt;Route ^/&gt;
    AuthType form https://example.com/login.html
&lt;/Route&gt;
</pre>
            <a id="authStores"></a>
            <h2>Password Stores</h2>
            <p>Appweb can retrieve passwords from the default system password database or from users configured
            via the config file.
            Selection of the password store is controlled by the <a href="dir/auth.html#authStore">AuthStore</a>
            directive. For example:</p>
<pre class="ui code segment">
AuthStore system
</pre>
This selects the Unix system PAM password database.
<pre class="ui code segment">
AuthStore config
User julie 9d8873a123eb506e7f8e84d1f2a26916 view
</pre>
            <p>The Unix system password database is managed via the <a href="http://kb.iu.edu/data/anpn.html">PAM</a> 
            interface. The Windows ActiveDirectory password store is not currently supported.</p>
            <p>The <em>AuthStore config</em> option specifies that passwords will be defined by the
            <a href="dir/auth.html#user">User</a> directive and will be stored internally in Appweb.
            The default password store for Appweb is "config". Typically, User directives are kept in a separate
            passwords are stored in a separate configuration file that is included from the <em>appweb.conf</em>
            master configuration file.</p>
<pre class="ui code segment">
include auth.conf
</pre>
            <a name="authpass"></a>
            <h2>Password Program</h2>
            <p>The <em>authpass</em> program supports the <em>internal</em> AuthStore and is used to create user
            passwords in an authentication file. Appweb uses the same authentication file and format for Basic, Digest
            and Form authentication types. This simplifies administration. The file simply contains User and Role
            directives and may be edited by hand if desired.</p> 
<pre class="ui code segment">
#
#   auth.conf - Authentication data
#
Role administrator view
Role executive manage direct
Role user view
User julie 9d8873a123eb506e7f8e84d1f2a26916 user
User peter 7cdba57892649fd95a540683fdf8fba6 user
User joshua 2fd6e47ff9bb70c0465fd2f5c8e5305e user administrator purchase
User mary 5b90553bea8ba3686f4239d62801f0f3 user executive
</pre>
            <p>The <em>authpass</em> program will create and modify User directives in the authentication file.</p>
            <p>The command line syntax for authpass is:</p>
            <pre class="ui code segment">
authpass [--create] [--cipher blowfish|md5] [--password word] \
    authFile realm username roles...
</pre>
            <p>The authFile parameter specifies the name of the authentication file. 
            The --cipher option specifies the cipher used to hash/crypt the password. The default is MD5 which is required
            for digest authentication. However blowfish is more secure. Blowfish is preferable for basic and
            form-based authentication</p>
            <p>If the --password option is not used, authpass will prompt for the password. The --create option will
            cause authpass to create the authentication file if it does not already exist. Otherwise it will update the
            nominated file.</p> 
            <p>The Realm is the name specified via the AuthRealm directive and is typically set to a company or product
            name.</p>
            <p><b>SECURITY WARNING</b>: it is essential that the authentication file be stored outside
            the Documents directory or any directory serving content.</p>
            <a name="api"></a>
            <h2>Authentication APIs</h2>
            <p>See the <a href="../ref/api/http.html#group___http_auth">HttpAuth API</a> for APIs to 
            manage authentication and authorization under program control. See also the 
            <a href="../ref/api/mpr.html#group___mpr_1gae8874a355db8bc6fa6d6bfa4dc8bbee6">mprMakePassword</a> and 
            <a href="../ref/api/mpr.html#group___mpr_1gaa7361e36abe129b975148d3f6faeff8c">mprCheckPassword</a> APIs to
            create and check Blowfish encrypted passwords.</p>

    </div>
    <div class="terms ui basic center aligned segment">
        <p>&copy; Embedthis Software, 2003-2014. All rights reserved.
            Generated on Sep 15, 2014.
        </p>
    </div>

    <script src="../lib/jquery/jquery.js"></script>
    <script src="../lib/semantic/js/semantic.js"></script>
    <script>
        var sl = $('.sidebar-launch');
        $('.sidebar-launch').click(function() {
            var body = $('body');
            if (!body.hasClass('show-sidebar')) {
                body.addClass('show-sidebar');
                $('.sidebar').css('visibility', 'visible');
            } else {
                body.removeClass('show-sidebar');
                $('.sidebar').css('visibility', 'hidden');
            }
        });
        $('.sidebar-launch').trigger('click');

        $(function() {
            var url = '../users/authentication.html';
            var active = $('.sidebar a[href="' + url +'"]');
            active.addClass('active');
            var sidebar = $(".sidebar");
            var height = sidebar.height();
            var offset = active.offset();
            if (offset && offset.top >= height) {
                var diff = height - active.offset().top;
                sidebar.scrollTop(height);
            }
        });
    </script> 

</body>
</html>
