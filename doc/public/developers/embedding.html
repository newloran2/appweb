<!DOCTYPE html>
<html lang="en">
<head>
    <title>Embedding</title>
    <!-- Copyright Embedthis Software, LLC, 2003-2014. All Rights Reserved. -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="appweb, embedded web server, embedded, devices, http server, internet of things, esp, goahead" />
    <meta name="description" content="The fastest little web server" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700'
        rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Julius+Sans+One' rel='stylesheet' type='text/css'>
    <link href="../lib/semantic/themes/packages/beach.css" rel="stylesheet" type="text/css" />
    <link href="../css/all.css" rel="stylesheet" type="text/css" />
    <link href="../images/favicon.ico" rel="shortcut icon" />

</head>
<body>
        <div class="sidebar">
        <div class="ui large left vertical inverted labeled menu">
            <div class="item">
                <a href="../index.html" class="logo">Appweb Docs</a>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../index.html">Home</a>
                    <a class="item" href="../users/features.html">Appweb Features</a>
                    <a class="item" href="https://embedthis.com/appweb/download.html">Download</a> 
                    <a class="item" href="../licensing/index.html">Licensing</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../start/index.html">Getting Started</a>
                    <a class="item" href="../start/quick.html">Quick Start</a>
                    <a class="item" href="../start/installing.html">Installing Appweb</a>
                    <a class="item" href="../start/starting.html">Starting and Stopping</a>
                    <a class="item" href="../start/service.html">Running as a Service</a>
                    <a class="item" href="../start/releaseNotes.html">Release Notes</a>
                    <a class="item" href="../start/source.html">Building from Source</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../users/index.html">User's Guide</a>
                    <a class="item" href="../users/configuration.html">Configuring Appweb</a>
                    <a class="item" href="../users/directives.html">Configuration Directives</a>
                    <a class="item" href="../users/frameworks.html">Web Frameworks</a>
                    <a class="item" href="../users/modules.html">Using Loadable Modules</a>
                    <a class="item" href="../users/ports.html">Ports and Binding</a>
                    <a class="item" href="../users/routing.html">Routing Requests</a>
                    <a class="item" href="../users/stages.html">Request Pipeline</a>
                    <a class="item" href="../users/lang.html">Multi-Language Content</a>
                    <a class="item" href="../users/authentication.html">User Authorization</a>
                    <a class="item" href="../users/logFiles.html">Logging</a>
                    <a class="item" href="../users/caching.html">Caching</a>
                    <a class="item" href="../users/vhosts.html">Virtual Hosts</a>
                    <a class="item" href="../users/ssl.html">Secure Sockets (SSL)</a>
                    <a class="item" href="../users/client.html">Http Client</a>
                    <a class="item" href="../users/security.html">Security Considerations</a>
                    <a class="item" href="../users/monitor.html">Monitoring and Defending</a>
                    <a class="item" href="../users/uploading.html">File Upload</a>
                    <a class="item" href="../users/webSockets.html">WebSockets</a>
                    <a class="item" href="../users/man.html">Man Pages</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../developers/index.html">Developer's Guide</a>
                    <a class="item" href="../developers/embedding.html">Embedding Appweb</a>
                    <a class="item" href="../developers/modules.html">Creating Appweb Modules</a>
                    <a class="item" href="../developers/handlers.html">Creating Appweb Handlers</a>
                    <a class="item" href="../developers/stages.html">Creating Pipeline Stages</a>
                    <a class="item" href="../developers/migrating.html">Migrating to Appweb 5</a>
                    <a class="item" href="../developers/rom.html">Serving Pages from ROM</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../ref/index.html">Reference Guide</a>
                    <a class="item" href="../ref/compatibility.html">Compatibility</a>
                    <a class="item" href="../ref/native.html">Native APIs</a>
                    <a class="item" href="../ref/architecture.html">Appweb Architecture</a>
                    <a class="item" href="../ref/memory.html">Appweb Memory Allocation</a>
                    <a class="item" href="../ref/multithread.html">Multithreaded Programming</a>
                    <a class="item" href="../standards/http.html">HTTP References</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <a class="header item" href="../developers/project.html">Project Resources</a>
                    <a class="item" href="http://goo.gl/dGRDl4">Official Appweb News</a>
                    <a class="item" href="https://embedthis.com/appweb/">Appweb Web Site</a>
                    <a class="item" href="https://github.com/embedthis/appweb">Source Code Repository</a>
                    <a class="item" href="https://github.com/embedthis/appweb/issues">Project Issue Database</a>
                    <a class="item" href="https://github.com/embedthis/appweb/releases">Change Log</a>
                    <a class="item" href="https://github.com/embedthis/appweb/milestones">Roadmap</a>
                    <a class="item" href="https://embedthis.com/developers/contributors.html">Contributors Agreement</a>
                </div>
            </div>
            <div class="item">
                <div class="menu">
                    <span class="header item">Links</span>
                    <a class="item" href="https://embedthis.com/">Embedthis Web Site</a>
                    <a class="item" href="https://embedthis.com/blog/">Embedthis Blog</a>
                    <a class="item" href="http://twitter.com/mobstream">Twitter</a>
                </div>
            </div>
        </div>
    </div>

    <div class="ui sidebar-launch button">
        <i class="icon list layout"></i>
    </div>





    <div class="masthead">
         
        <div class="ui inverted menu">
            <div class="right menu">
                  
                    <a class="item" href="https://embedthis.com/">Embedthis</a>
                    <a class="item" href="https://embedthis.com/appweb/">Appweb Site</a>
                    <a class="item" href="http://goo.gl/dGRDl4">Appweb News</a>
                    <a class="item" href="https://github.com/embedthis/appweb">Repository</a>
                    <a class="item" href="https://embedthis.com/blog/">Blog</a>
                    <a class="item" href="https://twitter.com/mobstream">Twitter</a>

            </div>
        </div>
        
        <div class="ui breadcrumb">
            <a class="section" href="../">Home</a>
            
            <div class="divider">/</div>
            <a class="section" href="index.html">
                Developer's Guide
            </a>
            
            
            <div class="divider">/</div>
            <a class="active section" href="embedding.html">Embedding</a>
            
        </div>
        
        <div class="ui right floated basic segment version">
            v5.2.0
        </div>

    </div>
    <div class="content">

            <h1 class="title">Embedding Appweb</h1>
            <p>When extending and embedding Appweb in your application or system, you have three options:</p>
            <ol>
                <li>Use the existing Appweb main program and extend Appweb via a loadable module.</li>
                <li>Use the existing Appweb main program and extend Appweb via the ESP web framework.</li>
                <li>Link the Appweb HTTP library with your application main program.</li>
            </ol><a id="loadable"></a>
            <h2>Extending via a Loadable Module</h2>
            <p>You can extend the Appweb server program by creating an Appweb loadable module. You do this by creating
            a shared library that contains your application and some Appweb module interface code. This module is then
            specified in the Appweb configuration file so that the Appweb program will load it. It requires about 10
            lines of code to create an Appweb module.</p>
            <h2>Extending via ESP</h2>
            <p>The Embedded Server Pages (ESP) web framework allows the direct embedding of "C" language code in
            HTML web pages. This is the easiest way to invoke "C" APIs in your program. ESP also supports the loading
            of Model/View/Controller (MVC-based) applications. ESP will compile and load controller source code. Controllers
            provide an easy and efficient way to invoke "C" code when requests are made to certain URIs.</p>
            <h2>Embed the Appweb Library</h2>
            <p>You can link the Appweb library with your application to enable it to listen for HTTP requests and thus
            become a HTTP server itself. Embedding the Appweb library is easy and can be done with as little as one
            line of code.</p>
            
            <a id="appwebProgram"></a>
            <h2>The Appweb Server Program</h2>
            <p>The Appweb product includes a fully-featured HTTP server program that uses the Appweb HTTP library. This
            server (called <b>appweb</b>) is run by default when you install the Appweb binary distribution or run
            "make install" after building from source.</p>
            <p>The Appweb server program is ideal for embedded systems as it offers the following features:</p>
            <ul>
                <li>High performance</li>
                <li>Extendable via loadable modules</li>
                <li>Deterministic memory footprint and CPU loads</li>
                <li>Configurable sandbox limits that control memory usage</li>
                <li>Monitored and managed by the Appweb manager process</li>
            </ul>
            
            <a id="module"></a>
            <h2>Creating a Module</h2>
            <p>You can extend the Appweb program by creating a loadable module for your application code.</p>
            <p>To initialize your module and register with Appweb, you must create an initialization function that is
            called when Appweb loads your module. This must be named according to the form:</p>
            <pre class="ui code segment">
ma<b>Name</b>ModuleInit(MaHttp *http)
</pre>
            <p>Where <b>Name</b> is the name of your module.</p>
            <p>This initialization function must call the <b>mprCreateModule</b> API to register with Appweb.</p>
            <pre class="ui code segment">
int mprSimpleModuleInit(Http *http, MprModule *module)
{
    /* Put custom code here */
    return 0;
}
</pre>
            <p>See <a href="modules.html">Creating Appweb Modules</a> for more details.</p><a id="library"></a>
            <h2>Embed the Appweb Library</h2>
            <p>You can link the Appweb HTTP library with your main program to enable it to function as a HTTP
            server itself. This is ideal if your application is large and/or has a complex I/O, eventing or threading
            paradigm.</p>
            <h3>Linking with the Appweb Library</h3>
            <p>To include the Appweb library in your program you need to do the following things:</p>
            <ol>
                <li>Add <b>#include "appweb/appweb.h"</b> to the relevant source files.</li>
                <li>Add the Appweb library to your Makefiles or Windows project files. This will mean adding
                    libappweb.dll on Windows or libappweb.so on Unix.</li>
                <li>Use one of the embedding APIs to create the HTTP server.</li>
            </ol>
            <h3>One Line Embedding</h3>
            <p>The following code demonstrates the one-line Appweb embedding API. This will create and configure a web
            server based on the "server.conf" configuration file.</p>
            <pre class="ui code segment">
#include "appweb/appweb.h"
int main(int argc, char** argv)
{
    return maRunWebServer("server.conf");
}
</pre>
            <p>To build this sample and link with the Appweb library:</p>
            <pre class="ui code segment">
cc -o server server.c -lappweb
</pre>
            <h3>Full Control API</h3>
            <p>The Appweb library also provides a lower level embedding interface where you can precisely control how
            the web server is created and configured. This API also exposes the inner event and threading
            mechanisms.</p>
            <p>This example creates a web server using the "server.conf" configuration file and will service events
            until terminated.</p>
            <pre class="ui code segment">
#include "appweb/appweb.h"
int main(int argc, char **argv)
{
    Mpr         *mpr;
    MaServer    *server;
    MaAppweb    *appweb;
    /*
     *  Initialize and start the portable runtime services.
     */
    if ((mpr = mprCreate(0, NULL, 0)) == 0) {
        mprError("Can't create the web server runtime");
        return 0;
    }
    if (mprStart() &lt; 0) {
        mprError("Can't start the web server runtime");
        return 0;
    }
    appweb = maCreateAppweb(mpr);
    mprAddRoot(appweb);
    if ((server = maCreateServer(appweb, 0)) == 0) {
        mprError("Can't create the web server");
        return 0;
    }
    if (maParseConfig(server, "server.conf") &lt; 0) {
        mprError("Can't parse the config file %s", "server.conf");
        return 0;
    }
    if (maStartServer(server) &lt; 0) {
        mprError("Can't start the web server");
        return MPR_ERR_CANT_CREATE;
    }
    mprServiceEvents(-1, 0);
    maStopServer(server);
    mprRemoveRoot(appweb);
    mprDestroy(MPR_EXIT_DEFAULT);
    return 0;
}
</pre>
            <h3>More Details</h3>
            <p>For more details about the embedding API, please consult the <a href="../ref/api/appweb.html">Appweb
            API</a> and the <a href="../ref/native.html">Native APIs</a>.</p>

    </div>
    <div class="terms ui basic center aligned segment">
        <p>&copy; Embedthis Software, 2003-2014. All rights reserved.
            Generated on Sep 15, 2014.
        </p>
    </div>

    <script src="../lib/jquery/jquery.js"></script>
    <script src="../lib/semantic/js/semantic.js"></script>
    <script>
        var sl = $('.sidebar-launch');
        $('.sidebar-launch').click(function() {
            var body = $('body');
            if (!body.hasClass('show-sidebar')) {
                body.addClass('show-sidebar');
                $('.sidebar').css('visibility', 'visible');
            } else {
                body.removeClass('show-sidebar');
                $('.sidebar').css('visibility', 'hidden');
            }
        });
        $('.sidebar-launch').trigger('click');

        $(function() {
            var url = '../developers/embedding.html';
            var active = $('.sidebar a[href="' + url +'"]');
            active.addClass('active');
            var sidebar = $(".sidebar");
            var height = sidebar.height();
            var offset = active.offset();
            if (offset && offset.top >= height) {
                var diff = height - active.offset().top;
                sidebar.scrollTop(height);
            }
        });
    </script> 

</body>
</html>
